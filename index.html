<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>화질구지네요~</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
    </style>
</head>
<body>
<canvas>
</canvas>
<script>
    const canvas = document.querySelector('canvas');
    const ctx = canvas.getContext('2d');

    // 캔버스 크기 설정
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let img = new Image();
    img.src = 'bird.jpg'; // 실제 이미지 URL로 변경 필요

    let mouseX = 0, mouseY = 0;
    let imgX = 0, imgY = 0; // 이미지의 초기 위치
    let lerpAmount = 0.2; // Lerp 속도 조절 (0에서 1 사이의 값)

    // 마우스 위치 업데이트
    document.addEventListener('mousemove', function(e) {
        mouseX = e.clientX;
        mouseY = e.clientY;
        draw(); // 마우스를 움직일 때마다 draw 함수 호출
    });

    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        draw(); // 캔버스 내용을 다시 그립니다.
    }

    window.addEventListener('resize', resizeCanvas);

    function lerp(start, end, amt) {
        return start + (end - start) * amt;
    }

    function alertAlarm(scaledWidth){
        if( scaledWidth <= 15 ){
            const message = "화질구지네요!"; // 표시할 메시지
            const textOffsetX = 40; // 텍스트 X 오프셋
            const textPositionX = mouseX + textOffsetX; // 텍스트 X 위치
            const textPositionY = mouseY; // 텍스트 Y 위치

            ctx.font = "50px Arial"; // 폰트 스타일 설정
            ctx.fillStyle = "black"; // 텍스트 색상 설정
            ctx.fillText(message, textPositionX, textPositionY); // 텍스트 그리기

        }
    }

    function draw() {
    const pixelation = Math.max(1, 20 * (1 - mouseX / canvas.width * 1.5));

    // Lerp 함수를 사용하여 이미지의 위치를 부드럽게 업데이트합니다.
    imgX = lerp(imgX, mouseX - 200 / 2, lerpAmount);
    imgY = lerp(imgY, mouseY - 200 / 2, lerpAmount);

    ctx.clearRect(0, 0, canvas.width, canvas.height); // 캔버스 클리어

    const size = 200; // 이미지의 고정 크기
    const scaledWidth = size / pixelation;
    const scaledHeight = size / pixelation;

    // 임시 캔버스를 사용하여 이미지의 픽셀화 처리를 수행합니다.
    const tempCanvas = document.createElement('canvas');
    const tempCtx = tempCanvas.getContext('2d');
    tempCanvas.width = scaledWidth;
    tempCanvas.height = scaledHeight;


    // 임시 캔버스에 픽셀화된 이미지를 그립니다.
    tempCtx.drawImage(img, 0, 0, scaledWidth, scaledHeight);
    // 메인 캔버스에 이미지의 현재 위치(imgX, imgY)에 픽셀화된 이미지를 그립니다.
    ctx.drawImage(tempCanvas, 0, 0, scaledWidth, scaledHeight, imgX, imgY, size, size);
    alertAlarm(scaledWidth);
}

    img.onload = function() {
        draw(); // 이미지 로드 시 초기 그리기
    };

    window.onload = function() {
    alert("마우스를 좌우로 움직여보세요!");
};

</script>
</body>
</html>
